<!DOCTYPE html>
<html manifest="appcache.manifest">
<head>
    <title>HTML5 Offline App</title>
    <link rel="stylesheet" href="offlineapp.css">

    <!--HTML Helper Function -->
    <script>
        var addEvent = (function () {
            if (document.addEventListener) {
                return function (el, type, fn) {
                    if (el && el.nodeName || el === window) {
                        el.addEventListener(type, fn, false);
                    } else if (el && el.length) {
                        for (var i = 0; i < el.length; i++) {
                            addEvent(el[i], type, fn);
                        }
                    }
                };
            } else {
                return function (el, type, fn) {
                    if (el && el.nodeName || el === window) {
                        el.attachEvent('on' + type, function () { return fn.call(el, window.event); });
                    } else if (el && el.length) {
                        for (var i = 0; i < el.length; i++) {
                            addEvent(el[i], type, fn);
                        }
                    }
                };
            }
        })();

        (function () {

            var pre = document.createElement('pre');
            pre.id = "view-source"

            // private scope to avoid conflicts with demos
            addEvent(window, 'click', function (event) {
                if (event.target.hash == '#view-source') {
                    // event.preventDefault();
                    if (!document.getElementById('view-source')) {
                        // pre.innerHTML = ('<!DOCTYPE html>\n<html>\n' + document.documentElement.innerHTML + '\n</html>').replace(/[<>]/g, function (m) { return {'<':'&lt;','>':'&gt;'}[m]});
                        var xhr = new XMLHttpRequest();

                        // original source - rather than rendered source
                        xhr.onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {
                                pre.innerHTML = this.responseText.replace(/[<>]/g, function (m) { return {'<':'&lt;','>':'&gt;'}[m]});
                                prettyPrint();
                            }
                        };

                        document.body.appendChild(pre);
                        // really need to be sync? - I like to think so
                        xhr.open("GET", location.origin + '/demos' + window.location.pathname.replace(/\/$/, '') + '.html', true);
                        xhr.send();
                    }
                    document.body.className = 'view-source';

                    var sourceTimer = setInterval(function () {
                        if (window.location.hash != '#view-source') {
                            clearInterval(sourceTimer);
                            document.body.className = '';
                        }
                    }, 200);
                }
            });

        })();
    </script>
</head>
<body>
    <div>
        <!-- Display the current network status-->
        <article>
            <p class="network">Current network status: <span id="status">checking...</span></p>
            <ol id="state"></ol>
        </article>

        <!-- Displays the current content of localStorage.pageLoadCount -->
        <article>
            <p>
                <b>
                    You have viewed this page
                    <span id="count">an untold number of</span>
                    time(s).
                </b>
            </p>
            <section id="directions">
                <p>
                    <li id="geo"></li>
                    <ol id="list"></ol>
                </p>
            </section>
        </article>


        <!--show cases usage of localStorage-->
        <script>
            if (!localStorage.pageLoadCount) {
                localStorage.pageLoadCount = 0;
            }
            localStorage.pageLoadCount = parseInt(localStorage.pageLoadCount) + 1;
            document.getElementById('count').textContent = localStorage.pageLoadCount;
        </script>


        <!--show cases the usage of the browser inbuilt online detection-->
        <script>
            var statusElem  = document.getElementById('status'),
                state 		= document.getElementById('state');

            function online(event) {
                statusElem.className = navigator.onLine ? 'online' : 'offline';
                statusElem.innerHTML = navigator.onLine ? 'online' : 'offline';
//                state.innerHTML += '<li>New event: ' + event.type + '</li>';
            }

            addEvent(window, 'online', online);
            addEvent(window, 'offline', online);
            online({ type: 'ready' });
        </script>

        <!--Just some messing around with geo location-->
        <script>
            var geoElem     = document.getElementById('geo');
            function getGeoLocation() {
                if (navigator.geolocation){
                    navigator.geolocation.getCurrentPosition(printPosition);
                } else {
                    geoElem.innerHTML = "Geolocation not supported by your browser."
                }
            }

            function printPosition(position) {
                geoElem.innerHTML = position.coords.longitude + ' , ' + position.coords.longitude;
            }
            getGeoLocation();
        </script>

            <!--Just some messing around with cookie -->
        <script>
            var listElem     = document.getElementById('list');
            function areCookiesEnabled() {
                listElem.innerHTML += '<li>Cookies enabled: ' + navigator.cookieEnabled + '</li>';
            }
            areCookiesEnabled();
        </script>
    </div>
</body>
</html>