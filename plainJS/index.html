<!DOCTYPE html>
<html>
<head>
    <title>Prime Movies with IMDB Rating</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
<div class="table-view">
    <table id="videosTable"><h1>Prime Movies with IMDB Rating</h1>
        <p id="resultsFrom">Results from: </p>
        <tr>
                <th class="movie">Movie</th>
                <th class="year">Year</th>
                <th class="rating">IMDB Rating</th>
                <th class="ratingCount">Rating Count</th>
            </tr>
    </table>

        <script>
            // Find a <table> element with id="videosTable":
            var tableElem = document.getElementById("videosTable");

            // load from php
            var resultsArray;
            var minRatingCount = 10000;
            $.ajax({
                //only possible on web videos
                //url: './getMoviesWithRatings.php?sortBy=ratingValue&order=descending&ratingCountMin=' + minRatingCount,
                url: 'http://imdbprime-snah.rhcloud.com/getMoviesWithRatings.php?sortBy=ratingValue&order=descending&ratingCountMin=10000',
                success: function(data) {
                    resultsArray = JSON.parse(data);

                    for (var i = 0; i < resultsArray.length; i++) {
                        // Create an empty <tr> element and add it to the 1st position of the table:
                        var row = tableElem.insertRow(i + 1);

                        // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
                        var titleCell = row.insertCell(0);
                        var yearCell = row.insertCell(1);
                        var ratingCell = row.insertCell(2);
                        var ratingCountCell = row.insertCell(3);

                        // Add some text to the new cells:
                        titleCell.innerHTML = '<a target="_blank" href=' + resultsArray[i].imdbMovieUrl + '>' + resultsArray[i].movie + '</a>';
                        yearCell.innerHTML = resultsArray[i].year;
                        ratingCell.innerHTML = resultsArray[i].ratingValue;
                        ratingCountCell.innerHTML = resultsArray[i].ratingCount;
                    }

                    // needs to be inside of the success function, otherwise getResultsDate will reutrn first
                    // and resultsArray will be empty
                    var resultsFromElem = document.getElementById("resultsFrom");
                    // load from php
                    $.ajax({
                        //only possible on web videos
                        //url: './getResultsDate.php',
                        url: 'http://imdbprime-snah.rhcloud.com/getResultsDate.php',
                        success: function(data) {
                            resultsFromElem.innerHTML += data + '<br>' + "With min Rating Count: " + minRatingCount + ": "+ resultsArray.length;
                        }
                    });
                }
            });
        </script>

    </div>
</body>
</html>